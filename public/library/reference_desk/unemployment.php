<?php require_once('../../../private/initialize.php') ?><!doctype html><?php $page_title = "Michigan unemployment" ?><html lang="en"><?php require(SHARED_PATH . '/head.php') ?>    <style>    table{		margin: 0 0 50px 0;	}    table th{	text-align:center;	 background: #e0e0e0;     padding: 10px!important;    }    table td{		height: 80px;		padding: 10px!important;		text-align:center;		vertical-align:middle;		width:20%!important;    }    select{		display:block;		margin: 20px 0 50px 0;		padding:10px;	}	select, #unemployment-data{		opacity:0;		transition: all .25s;	}	#difference.success{		background-color: lightgreen;	}	#difference.warning{		background-color: lightcoral;	}    </style>  <body>   <div class="container">   <?php include(SHARED_PATH . '/navigation.php') ?>	<section>	  <div class="row">		<div class="col-12">            <h3><?php echo h($page_title); ?></h3>            <p>Michigan's <a href="https://data.michigan.gov" target="_blank">Open Data Portal</a>            has several free APIs, including <a href="https://data.michigan.gov/Economy/Unemployment-Rate/kamp-ngb9" target="_blank">a record of Michigan's unemployement rates as compared to the national rate.</a>.Since I use a lot of jQuery at work, I used this collection as an exercise infetching JSON data from an endpoint using only Vanilla JS and PHP.</p>			<p>The raw JSON wasn't ordered by date, so I had to do a bit of data management to make the &lt;select&gt; field more user-friendly.</p>			<p>Select a month and year. If Michigan's unemployment rate is higher than the national average, the "Difference" field				will appear in red. If it is lower, it will appear in green.</p>        </div>    </div>    <div class="row">		<div class="col-12">            <h3 style="margin-top:20px;">Unemployment Data, 1976-2017</h3>            <select id="unemployment-select">            </select>            <div id="unemployment-data">                <table class="table table-bordered">                    <tr>                        <th>Date</th>                        <th>Michigan Unemployment Rate</th>                        <th>US Unemployment Rate</th><th>Difference</th>						 <th>Rank</th>                    </tr>                    <tr>                        <td id="date"></td>                        <td id="unemployment_rate_mi"></td>                        <td id="unemployment_rate_us"></td>                        <td id="difference"></td>						 <td id="rank"></td>                    </tr>                </table>				<br />            </div>        </div>    </div>	</section>	<?php		include(SHARED_PATH . '/footer.php')	?>  </body>  <?php require(SHARED_PATH . '/scripts.php') ?>  <script>	var KPL = KPL || {};	KPL.unemployment = function(){	  var unemploymentJSON = {};      var unemploymentSelect = document.getElementById ("unemployment-select"),		unemploymentTable = document.getElementById ("unemployment-data");		function fetchUnemployment(){			var unemploymentOptions = '<option value="">Select a month and year</option>';			var unemploymentArray = [];		  var xhr = new XMLHttpRequest();		  xhr.open('GET', 'https://data.michigan.gov/resource/hwii-cqxt.json', true);		  xhr.onreadystatechange = function(){				if(xhr.readyState == 4 && xhr.status == 200){					unemploymentJSON = JSON.parse(xhr.responseText);					/* The API data is not ordered by date, so push all dates into an array */					for (key in unemploymentJSON) {					  if (unemploymentJSON.hasOwnProperty(key)) {						unemploymentArray.push(unemploymentJSON[key].date);					  }					}					/* then sort by date, newest first */					unemploymentArray.sort(function(a, b){return new Date(b) - new Date(a)});					/* then create the option list */					for (var i = 0; i < unemploymentArray.length; i++) {						unemploymentOptions +='<option value="' + unemploymentArray[i] + '">' + formatDate(unemploymentArray[i]) + '</value>';					}					unemploymentSelect.innerHTML = unemploymentOptions;					unemploymentSelect.addEventListener("change", function() {						findUnemploymentRate(unemploymentSelect.value);					});					unemploymentSelect.style.opacity = 1;					unemploymentTable.style.opacity = 1;				}			};			xhr.send();		}		function formatDate(date){			/* dates like Feb-78 will parse directly to new Dates			 but dates like Jan-03 will not			 so transform the 21st century dates to 'Jan-2003', etc. before localizing */			var dateSplit = date.split('-');			var year = Number(dateSplit[1]);			if (year >= 0 && year <= 9){				dateSplit[1] = '200' + year;			}			if (year >= 10 && year <= 18){				dateSplit[1] = '20' + year;			}			formattedDate = dateSplit.join();			var newDate = new Date(formattedDate);			return newDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long' });		}		function findUnemploymentRate(date){			var dateField = document.getElementById ("date"),				unemploymentMI = document.getElementById ("unemployment_rate_mi"),				unemploymentUS = document.getElementById ("unemployment_rate_us"),				difference = document.getElementById ("difference");				rank = document.getElementById ("rank");				difference.removeAttribute("class");			for (key in unemploymentJSON) {			  if (unemploymentJSON.hasOwnProperty(key)) {				if(date === unemploymentJSON[key].date){					miNumber = (Number(unemploymentJSON[key].unemployment_rate_mi) * 100).toFixed(2);					usNumber = (Number(unemploymentJSON[key].unemployment_rate_us) * 100).toFixed(2);					dateField.innerHTML = formatDate(unemploymentJSON[key].date);					unemploymentMI.innerHTML = miNumber + ' %';					unemploymentUS.innerHTML =  usNumber + ' %';					difference.innerHTML = (miNumber - usNumber).toFixed(2) + '%';					rank.innerHTML = unemploymentJSON[key].rank || "not ranked";					if((usNumber - miNumber) <= 0){						difference.classList.add('warning');					} else {						difference.classList.add('success');					}					/* this exercise was more depressing than I thought it would be */				}			  }			}		}		fetchUnemployment();	};	document.addEventListener("DOMContentLoaded", function() {	  KPL.unemployment();	});    </script></html>